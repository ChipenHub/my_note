
> Problem: [2438. 二的幂数组中查询范围内的乘积](https://leetcode.cn/problems/range-product-queries-of-powers/description/)

[TOC]

# 思路

> 先求出 `power` 数组，创建前缀积数组，按要求求范围积即可。

# 解题过程

> 拆分出所有 1 的二进制位保存到数组中，构建前缀积数组后，定义快速幂，利用费马小定理计算除法结果。

# 复杂度

- 时间复杂度: $O(n*logn)$
- 空间复杂度: $O(n)$



# Code
```cpp
class Solution {
public:
    vector<int> productQueries(int n, vector<vector<int>>& queries) {
        const int MOD = 1e9 + 7;
        vector<int> powers;

        for (int i = 0; i < 32; i++) {
            if ((n >> i) & 1)
                powers.push_back(1 << i);
        }
        vector<long long> f(powers.size() + 1, 1);
        for (int i = 1; i <= powers.size(); i++) {
            f[i] = (f[i - 1] * powers[i - 1]) % MOD;
        }

        auto modpow = [&](long long a, long long b) {
            long long res = 1;
            while (b) {
                if (b & 1)
                    res = (res * a) % MOD;
                a = (a * a) % MOD;
                b >>= 1;
            }
            return res;
        };

        vector<int> ret;
        for (auto& q : queries) {
            int l = q[0], r = q[1];
            int ans = (f[r + 1] * modpow(f[l], MOD - 2)) % MOD;
            ret.push_back(ans);
        }
        return ret;
    }
};
```
