#### 3.8

##### 对象使用的优化

![image-20250308102850371](C:\Users\姜雨奇\AppData\Roaming\Typora\typora-user-images\image-20250308102850371.png)

![image-20250308103222645](C:\Users\姜雨奇\AppData\Roaming\Typora\typora-user-images\image-20250308103222645.png)

指针/引用管理临时对象的区别。

![image-20250308103515458](C:\Users\姜雨奇\AppData\Roaming\Typora\typora-user-images\image-20250308103515458.png)

练习。

![image-20250308104526469](C:\Users\姜雨奇\AppData\Roaming\Typora\typora-user-images\image-20250308104526469.png)

##### 函数调用的优化

为什么不能返回指针（如图）或者引用？

![image-20250308104949008](C:\Users\姜雨奇\AppData\Roaming\Typora\typora-user-images\image-20250308104949008.png)

tmp为栈中变量，函数调用结束会销毁，造成空指针。

函数调用过程中的调用。

![image-20250308105455293](C:\Users\姜雨奇\AppData\Roaming\Typora\typora-user-images\image-20250308105455293.png)

##### 三条对象优化的原则

1. 函数参数传递过程中，对象优先按引用传递，不要按值传递。

2. 函数返回对象时， 优先返回临时对象， 不要返回定义过的对象。

   ![image-20250308110035901](C:\Users\姜雨奇\AppData\Roaming\Typora\typora-user-images\image-20250308110035901.png)

3. 接收返回值是对象的函数调用的时候，优先按初始化的方式接收，不要按赋值的方式接收。

   ![image-20250308110802839](C:\Users\姜雨奇\AppData\Roaming\Typora\typora-user-images\image-20250308110802839.png)

#### 3.9

##### move移动语义和forward类型完美转发

右值引用变量为左值，调用其需要用move转化为右值。

![image-20250309084950855](C:\Users\姜雨奇\AppData\Roaming\Typora\typora-user-images\image-20250309084950855.png)

##### 智能指针：资源的自动释放。

利用栈上的对象出作用域自动析构的特征来做到资源的自动释放。

**智能指针不能开在堆上**

auto_ptr：程序崩溃，auto_ptr进行赋值或拷贝构造会转让所有权。

![image-20250309092248245](C:\Users\姜雨奇\AppData\Roaming\Typora\typora-user-images\image-20250309092248245.png)

scope_ptr：去除拷贝构造和赋值重载。

![image-20250309092433478](C:\Users\姜雨奇\AppData\Roaming\Typora\typora-user-images\image-20250309092433478.png)

unique_ptr：带右值引用的拷贝构造和赋值重载。

![image-20250309092914184](C:\Users\姜雨奇\AppData\Roaming\Typora\typora-user-images\image-20250309092914184.png)

**带引用计数的智能指针**

![image-20250309094210453](C:\Users\姜雨奇\AppData\Roaming\Typora\typora-user-images\image-20250309094210453.png)

![image-20250309094339984](C:\Users\姜雨奇\AppData\Roaming\Typora\typora-user-images\image-20250309094339984.png)

![image-20250309173018667](C:\Users\姜雨奇\AppData\Roaming\Typora\typora-user-images\image-20250309173018667.png)

智能指针对于不同资源需要自定义删除器。

![image-20250309175056639](C:\Users\姜雨奇\AppData\Roaming\Typora\typora-user-images\image-20250309175056639.png)

绑定器：二元函数对象 => 一元函数对象。

![image-20250309181634966](C:\Users\姜雨奇\AppData\Roaming\Typora\typora-user-images\image-20250309181634966.png)

function函数对象类型的应用实例。

![image-20250309184816644](C:\Users\姜雨奇\AppData\Roaming\Typora\typora-user-images\image-20250309184816644.png)

功能：可以保留如lambda表达式，绑定器绑定的函数对象等。

模板的完全特例化和非完全（部分）特例化，模板的实参推演。

**注意：函数模板可以进行实例化，否则编译器会自动推演。**

实参推演：

![image-20250309185930322](C:\Users\姜雨奇\AppData\Roaming\Typora\typora-user-images\image-20250309185930322.png)

完全特例化：

![image-20250309190023193](C:\Users\姜雨奇\AppData\Roaming\Typora\typora-user-images\image-20250309190023193.png)

![image-20250309190209619](C:\Users\姜雨奇\AppData\Roaming\Typora\typora-user-images\image-20250309190209619.png)

部分特例化：

![image-20250309190457468](C:\Users\姜雨奇\AppData\Roaming\Typora\typora-user-images\image-20250309190457468.png)

**辨析**：函数类型和函数指针类型。

![image-20250309191840512](C:\Users\姜雨奇\AppData\Roaming\Typora\typora-user-images\image-20250309191840512.png)

function函数对象类型的实现原理

![image-20250309193615727](C:\Users\姜雨奇\AppData\Roaming\Typora\typora-user-images\image-20250309193615727.png)

bind和function实现多线程池。

bind的使用：

bind是函数模板，返回的是函数对象。

可用function类保存。

![image-20250309194456406](C:\Users\姜雨奇\AppData\Roaming\Typora\typora-user-images\image-20250309194456406.png)

![image-20250309194610686](C:\Users\姜雨奇\AppData\Roaming\Typora\typora-user-images\image-20250309194610686.png)
