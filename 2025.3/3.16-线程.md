# 进程组和会话

+ 进程聚集成为进程组，多个进程组聚集成为会话。
+ ps ajx 查看进程组 id 和会话 id

# 守护进程

+ linux 后台的一些服务进程，没有控制终端，不能直接和用户交互。不受用户登录注销的影响，一直在后台运行。周期性执行某种任务或者等待某一事件发生。一般采用以 d 结尾的命名方式。	

# 线程

### 线程的概念

+ linux 系统中，线程 LWP 称之为：轻量级的进程。
+ 进程：有独立的进程地址空间，又独立的 pcb。——最小的资源分配单位
+ 线程：有独立的 pcb，没有独立的进程地址空间（与其他线程共享）。——最小的执行单位

+ 一个创建了线程的进程本身也沦为线程。
+ LWP 号：cpu 划分时间片依据。
	+ 查看 LWP 号：ps -Lf 进程 pid

## 线程共享
+ 独享：栈空间（用户栈，内核栈）
+ 共享：./text，./ordata，./data，./bss heap -> 共享全局变量

## 线程优缺点
+ 优点：
	+ 并发性强
	+ 开销小
	+ 数据通信方便
+ 缺点：
	+ 库函数，稳定性差
	+ 调试、编写困难
	+ 对信号支持差
+ 结论：既能使用进程开发，也能用线程开发的程序，首选线程。

## 线程控制原语
### 获取线程 id

```c
#include <pthread.h>
pthread_t pthread_self(void); // 获取线程 id，在内部表示线程身份。
返回线程 id，没有错误。
```



### 创建线程

```c
#include <pthread.h>

int pthread_create(pthread_t *thread, const pthread_attr_t *attr,
                  void *(*start_routine) (void *), void *arg);
参 1：传出参数，新子线程的 id
参 2：线程属性。默认传 NULL，表示使用默认属性。
参 3：子线程的回调函数。pthread_create 调用成功，该函数会被自动调用起来。
参 4：参 3 的参数。
返回值：
    成功：0
    失败：直接返回错误号
```

+ 线程中处理出错

### 线程退出

```c
void pthtead_exit(void *retval)
参：代表线程的退出值。无退出值，NULL
```

+ 结论：
	+ return：返回到调用者
	+ exit()：退出当前进程
	+ pthread_exit()：退出当前线程

### 线程回收

```c
int pthread_join(pthread_t thread, void **retval);
参 1：待回收的线程 id
参 2：传出参数。回收的线程的退出值。
返回值：
    成功：0
    失败：直接返回错误号
```

### 线程分离

```c
int pthread_detach(pthread_t thread);
参：待分离的线程 id
```

+ 设置为分离态的线程，在终止时，会自动清理 pcb 内核残留。
+ 对于已分离的线程，使用 pthread_join() 不能正常回收。

### 杀死线程

```c
int pthread_cancel(pthread_t thread);
参：待杀死的线程 id
```

1. 被 pthread_cancel() 杀死的线程，再使用 pthread_join() 函数回收，得到的退出值 -1。
2. pthread_cancel() 杀死线程必须到达一个保存点才能生效。否则无法杀死线程。
	+ 应该在被 cancel 的线程中，调用 pthread_testcancel() 函数来添加保存点

### 终止线程的方法

1. return
2. pthread_exit
3. pthread_cancel

